# MCP å·¥å…·ä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æœ¬ MCP å®ç°ä¸ºè´¢åŠ¡æ™ºèƒ½åŠ©æ‰‹æä¾›äº†ä¸¤ç±»å·¥å…·ï¼š

1. **HTTP API å·¥å…·** - è°ƒç”¨å¤–éƒ¨æŠ¥é”€ç³»ç»Ÿ API
2. **æ•°æ®åº“å·¥å…·** - æŸ¥è¯¢å’Œæ“ä½œ SQLite æ•°æ®åº“

## ğŸ“‹ å·¥å…·æ¸…å•

### 1. HTTP API å·¥å…·

#### 1.1 query_reimbursement_status
**åŠŸèƒ½**: æŸ¥è¯¢æŠ¥é”€çŠ¶æ€

**å‚æ•°**:
- `employee_id` (å¿…éœ€): å‘˜å·¥å·¥å·ï¼Œå¦‚ "E001"
- `reimbursement_id` (å¯é€‰): æŠ¥é”€å•å·
- `start_date` (å¯é€‰): å¼€å§‹æ—¥æœŸï¼Œæ ¼å¼ "YYYY-MM-DD"
- `end_date` (å¯é€‰): ç»“æŸæ—¥æœŸï¼Œæ ¼å¼ "YYYY-MM-DD"

**è¿”å›**: æŠ¥é”€è®°å½•åˆ—è¡¨å’Œæ€»é‡‘é¢

**ç¤ºä¾‹**:
```python
result = query_reimbursement_status_tool(
    employee_id="E001",
    start_date="2024-03-01",
    end_date="2024-03-31"
)
```

#### 1.2 query_reimbursement_summary
**åŠŸèƒ½**: æŸ¥è¯¢æŠ¥é”€ç»Ÿè®¡

**å‚æ•°**:
- `employee_id` (å¿…éœ€): å‘˜å·¥å·¥å·
- `start_date` (å¿…éœ€): å¼€å§‹æ—¥æœŸ
- `end_date` (å¿…éœ€): ç»“æŸæ—¥æœŸ
- `category` (å¯é€‰): æŠ¥é”€ç±»åˆ«

**è¿”å›**: ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»é‡‘é¢ã€æŒ‰ç±»åˆ«ç»Ÿè®¡ã€æŒ‰çŠ¶æ€ç»Ÿè®¡ï¼‰

**ç¤ºä¾‹**:
```python
result = query_reimbursement_summary_tool(
    employee_id="E001",
    start_date="2024-03-01",
    end_date="2024-03-31"
)
```

### 2. æ•°æ®åº“å·¥å…·

#### 2.1 query_employee_info
**åŠŸèƒ½**: æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯

**å‚æ•°** (è‡³å°‘æä¾›ä¸€ä¸ª):
- `employee_id` (å¯é€‰): å‘˜å·¥å·¥å·
- `name` (å¯é€‰): å‘˜å·¥å§“åï¼ˆæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ï¼‰
- `department` (å¯é€‰): éƒ¨é—¨åç§°

**è¿”å›**: å‘˜å·¥ä¿¡æ¯åˆ—è¡¨

**ç¤ºä¾‹**:
```python
# æŒ‰å·¥å·æŸ¥è¯¢
result = query_employee_info_tool(employee_id="E001")

# æŒ‰å§“åæŸ¥è¯¢
result = query_employee_info_tool(name="å¼ ä¸‰")

# æŒ‰éƒ¨é—¨æŸ¥è¯¢
result = query_employee_info_tool(department="è´¢åŠ¡éƒ¨")
```

#### 2.2 query_reimbursement_records
**åŠŸèƒ½**: æŸ¥è¯¢æŠ¥é”€è®°å½•

**å‚æ•°**:
- `employee_id` (å¿…éœ€): å‘˜å·¥å·¥å·
- `start_date` (å¯é€‰): å¼€å§‹æ—¥æœŸ
- `end_date` (å¯é€‰): ç»“æŸæ—¥æœŸ
- `status` (å¯é€‰): çŠ¶æ€ç­›é€‰ï¼ˆpending/approved/rejected/paidï¼‰
- `limit` (å¯é€‰): è¿”å›è®°å½•æ•°é™åˆ¶ï¼Œé»˜è®¤ 100

**è¿”å›**: æŠ¥é”€è®°å½•åˆ—è¡¨

**ç¤ºä¾‹**:
```python
result = query_reimbursement_records_tool(
    employee_id="E001",
    start_date="2024-03-01",
    end_date="2024-03-31",
    status="pending"
)
```

#### 2.3 create_work_order
**åŠŸèƒ½**: åˆ›å»ºæˆ–æ›´æ–°å·¥å•

**å‚æ•°**:
- `title` (å¿…éœ€): å·¥å•æ ‡é¢˜
- `assignee_id` (å¿…éœ€): è´Ÿè´£äººå·¥å·æˆ–å§“åï¼ˆæ¨èä½¿ç”¨å·¥å·ï¼‰
- `description` (å¯é€‰): å·¥å•æè¿°
- `priority` (å¯é€‰): ä¼˜å…ˆçº§ï¼ˆlow/medium/high/urgentï¼‰ï¼Œé»˜è®¤ medium
- `category` (å¯é€‰): å·¥å•ç±»åˆ«
- `duplicate_reason` (å¯é€‰): å¦‚å­˜åœ¨ç›¸åŒæ ‡é¢˜+è´Ÿè´£äººç»„åˆä½†ä»éœ€æ–°å»ºï¼Œéœ€è¯´æ˜åŸå› 
- `request_id` (å¯é€‰): å¤–éƒ¨è¯·æ±‚ç¼–å·æˆ–ä¸šåŠ¡å‡­æ®ï¼Œæ–¹ä¾¿è¿½è¸ª
- `action` (å¯é€‰): 
  - `auto`ï¼ˆé»˜è®¤ï¼‰ï¼šæ£€æµ‹åˆ°é‡å¤å·¥å•æ—¶è¿”å›å·²æœ‰å·¥å•è¯¦æƒ…ï¼Œå¹¶æç¤ºä¸‹ä¸€æ­¥æ“ä½œï¼›
  - `create_new`ï¼šå¼ºåˆ¶æ–°å»ºï¼Œéœ€è¦é…åˆ `duplicate_reason`;
  - `update_existing`ï¼šç›´æ¥æ›´æ–°å·²æœ‰å·¥å•ï¼ˆæè¿°ã€ä¼˜å…ˆçº§ã€ç±»åˆ«ç­‰ï¼‰ã€‚

**è¿”å›**: åˆ›å»ºæˆ–æ›´æ–°åçš„å·¥å•ä¿¡æ¯ï¼ˆåŒ…å«å”¯ä¸€å·¥å•å·ã€è´Ÿè´£äººã€ä¼˜å…ˆçº§åŠå¤‡æ³¨ï¼‰

**æ³¨æ„äº‹é¡¹**:
- ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥ç›¸åŒæ ‡é¢˜+è´Ÿè´£äººä¸”çŠ¶æ€ä¸º open/in_progress çš„å·¥å•ï¼Œå¹¶è¿”å›å·²æœ‰å·¥å•çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå·¥å•å·ã€çŠ¶æ€ã€è´Ÿè´£äººã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰ã€‚
- é‡åˆ°é‡å¤æ—¶ï¼Œç”¨æˆ·å¯é€‰æ‹©ï¼š
  - è®¾ç½® `action="update_existing"` æ›´æ–°ç°æœ‰å·¥å•ï¼ˆæè¿°ä¼šè‡ªåŠ¨è®°å½•æ›´æ–°æ—¶é—´ä¸åŸå› ï¼‰ï¼›
  - è®¾ç½® `action="create_new"` ä¸”æä¾› `duplicate_reason` æ¥æ–°å»ºé™„å¸¦è¯´æ˜çš„å·¥å•ï¼›
  - ä»…æŸ¥è¯¢ç°çŠ¶ï¼ˆä¿æŒ `action="auto"`ï¼‰ä»¥ç¡®è®¤æ˜¯å¦å·²æœ‰å·¥å•åœ¨å¤„ç†ä¸­ã€‚
- å·¥å•å·åŒ…å«æ—¶é—´æˆ³ + éšæœºåç¼€ï¼ŒåŒæ—¶å¯é™„å¸¦ `request_id`ï¼Œä¾¿äºåç»­è¿½è¸ªä¸æŸ¥æ‰¾ã€‚

**ç¤ºä¾‹**:
```python
# æŸ¥è¯¢æˆ–åˆ›å»º
result = create_work_order_tool(
    title="å®¡æ ¸å¼ ä¸‰3æœˆä»½æŠ¥é”€ç”³è¯·",
    assignee_id="E004",
    priority="high",
    category="è´¢åŠ¡",
    duplicate_reason="è¡¥å½•å¼ ä¸‰å·®æ—…å•æ®",
    request_id="REQ-2024-03-001",
    action="create_new"
)

# æ›´æ–°å·²æœ‰å·¥å•
result = create_work_order_tool(
    title="å®¡æ ¸å¼ ä¸‰3æœˆä»½æŠ¥é”€ç”³è¯·",
    assignee_id="E004",
    description="å·²è¡¥é½é…’åº—å‘ç¥¨ï¼Œè¯·ä¼˜å…ˆå¤„ç†",
    priority="urgent",
    action="update_existing"
)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: åˆå§‹åŒ–æ•°æ®åº“

```bash
python mcp/init_database.py
```

### æ­¥éª¤ 2: å¯åŠ¨æ¨¡æ‹Ÿ API æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰

```bash
python mcp/mock_api_server.py
```

### æ­¥éª¤ 3: æµ‹è¯•å·¥å…·

```bash
python mcp/test_mcp_tools.py
```

### æ­¥éª¤ 4: é›†æˆåˆ° Agent

```bash
python mcp/integrate_with_langchain.py
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1: æŸ¥è¯¢å‘˜å·¥æŠ¥é”€æ€»é‡‘é¢

**ç”¨æˆ·é—®é¢˜**: "å¸®æˆ‘æŸ¥ä¸€ä¸‹å¼ ä¸‰ 3 æœˆä»½çš„æŠ¥é”€æ€»é‡‘é¢"

**Agent æ‰§è¡Œæµç¨‹**:
1. è°ƒç”¨ `query_employee_info(name="å¼ ä¸‰")` è·å–å‘˜å·¥å·¥å·
2. è°ƒç”¨ `query_reimbursement_summary(employee_id="E001", start_date="2024-03-01", end_date="2024-03-31")` è·å–ç»Ÿè®¡
3. ç”Ÿæˆå›ç­”

### åœºæ™¯ 2: åˆ›å»ºå·¥å•

**ç”¨æˆ·é—®é¢˜**: "å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå·¥å•ï¼Œæ ‡é¢˜æ˜¯'å®¡æ ¸æŠ¥é”€ç”³è¯·'ï¼Œåˆ†é…ç»™è´¢åŠ¡éƒ¨çš„èµµå…­"

**Agent æ‰§è¡Œæµç¨‹**:
1. è°ƒç”¨ `query_employee_info(name="èµµå…­", department="è´¢åŠ¡éƒ¨")` è·å–å‘˜å·¥å·¥å·
2. è°ƒç”¨ `create_work_order(title="å®¡æ ¸æŠ¥é”€ç”³è¯·", assignee_id="E004")` åˆ›å»ºå·¥å•
3. è¿”å›å·¥å•ä¿¡æ¯

### åœºæ™¯ 3: æŸ¥è¯¢å¾…å®¡æ‰¹æŠ¥é”€

**ç”¨æˆ·é—®é¢˜**: "æŸ¥ä¸€ä¸‹æå››æœ‰æ²¡æœ‰å¾…å®¡æ‰¹çš„æŠ¥é”€"

**Agent æ‰§è¡Œæµç¨‹**:
1. è°ƒç”¨ `query_employee_info(name="æå››")` è·å–å‘˜å·¥å·¥å·
2. è°ƒç”¨ `query_reimbursement_status(employee_id="E002")` è·å–æŠ¥é”€çŠ¶æ€
3. ç­›é€‰ status="pending" çš„è®°å½•
4. è¿”å›ç»“æœ

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“è·¯å¾„
é»˜è®¤è·¯å¾„: `mcp/data/finance.db`

### API æœåŠ¡å™¨åœ°å€
é»˜è®¤åœ°å€: `http://localhost:5001`

å¦‚éœ€ä¿®æ”¹ï¼Œè¯·ç¼–è¾‘ `mcp/mcp_tools.py` ä¸­çš„ `API_BASE_URL` å˜é‡ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“åˆå§‹åŒ–**: é¦–æ¬¡ä½¿ç”¨å‰å¿…é¡»è¿è¡Œ `init_database.py`
2. **API æœåŠ¡å™¨**: HTTP API å·¥å…·éœ€è¦å…ˆå¯åŠ¨ `mock_api_server.py`
3. **å‚æ•°æ ¼å¼**: æ—¥æœŸæ ¼å¼å¿…é¡»ä¸º "YYYY-MM-DD"
4. **å‘˜å·¥å·¥å·**: ç¡®ä¿å‘˜å·¥å·¥å·å­˜åœ¨ï¼Œå¦åˆ™æŸ¥è¯¢ä¼šå¤±è´¥
5. **é”™è¯¯å¤„ç†**: æ‰€æœ‰å·¥å…·éƒ½åŒ…å«é”™è¯¯å¤„ç†ï¼Œä¼šè¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **MCPè®¾è®¡æ–‡æ¡£.md** - å®Œæ•´çš„è®¾è®¡æ–‡æ¡£
- **test_cases.md** - æµ‹è¯•ç”¨ä¾‹è¯´æ˜
- **README.md** - é¡¹ç›®è¯´æ˜

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ•°æ®åº“ä¸å­˜åœ¨
**é”™è¯¯**: `FileNotFoundError: æ•°æ®åº“ä¸å­˜åœ¨`

**è§£å†³**: è¿è¡Œ `python mcp/init_database.py`

### é—®é¢˜ 2: API è¯·æ±‚å¤±è´¥
**é”™è¯¯**: `HTTPè¯·æ±‚å¤±è´¥: Connection refused`

**è§£å†³**: å¯åŠ¨ API æœåŠ¡å™¨ `python mcp/mock_api_server.py`

### é—®é¢˜ 3: å‘˜å·¥ä¸å­˜åœ¨
**é”™è¯¯**: `æœªæ‰¾åˆ°åŒ¹é…çš„å‘˜å·¥ä¿¡æ¯`

**è§£å†³**: æ£€æŸ¥å‘˜å·¥å·¥å·æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è¿è¡Œ `init_database.py` é‡æ–°åˆå§‹åŒ–æ•°æ®åº“

### é—®é¢˜ 4: å·¥å…·è°ƒç”¨å¤±è´¥
**é”™è¯¯**: `å·¥å…·è°ƒç”¨å¤±è´¥: ...`

**è§£å†³**: 
1. æ£€æŸ¥å‚æ•°æ ¼å¼æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ•°æ®åº“/API æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯å®šä½é—®é¢˜

