# ç»Ÿä¸€è´¢åŠ¡åŠ©æ‰‹ Agent ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

`UnifiedFinancialAgent` æ˜¯ä¸€ä¸ªæ•´åˆäº† RAG çŸ¥è¯†åº“æ£€ç´¢å’Œ MCP å·¥å…·è°ƒç”¨çš„æ™ºèƒ½è´¢åŠ¡åŠ©æ‰‹ï¼Œæ”¯æŒå¤šæ­¥éª¤æ¨ç†å’Œè‡ªä¸»å·¥å…·é€‰æ‹©ã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

1. **å¤šæ­¥éª¤æ¨ç†**ï¼šèƒ½å¤Ÿè‡ªä¸»è§„åˆ’æ‰§è¡Œæ­¥éª¤ï¼Œåœ¨ä¸€æ¬¡å¯¹è¯ä¸­å®Œæˆå¤æ‚ä»»åŠ¡
2. **å·¥å…·æ•´åˆ**ï¼šæ— ç¼æ•´åˆ RAG çŸ¥è¯†åº“æ£€ç´¢å’Œ MCP æ•°æ®æŸ¥è¯¢å·¥å…·
3. **æ„å›¾ç†è§£**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’
4. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
5. **ç»“æœæ•´åˆ**ï¼šè‡ªåŠ¨åˆå¹¶å¤šä¸ªå·¥å…·çš„ç»“æœï¼Œç”Ÿæˆå®Œæ•´ç­”æ¡ˆ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨

```python
from rag_system.agent.unified_agent import UnifiedFinancialAgent

# åˆ›å»º Agent
agent = UnifiedFinancialAgent(verbose=True)

# æ‰§è¡ŒæŸ¥è¯¢
result = agent.run("å·®æ—…è´¹æŠ¥é”€çš„æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ")

print(result["answer"])
```

### 2. å¤æ‚ä»»åŠ¡ç¤ºä¾‹

```python
# å¤æ‚ä»»åŠ¡ï¼šæŸ¥è¯¢è§„åˆ™ + æŸ¥è¯¢æ•°æ® + ç”Ÿæˆå†…å®¹
question = "æˆ‘æƒ³ç”³è¯·å·®æ—…æŠ¥é”€ï¼Œå¸®æˆ‘ç¡®è®¤ä¸‹æˆ‘æ˜¯å¦ç¬¦åˆæŠ¥é”€æ¡ä»¶ï¼Œå¹¶å¸®æˆ‘å†™ä¸€å°å‘ç»™ HR çš„é‚®ä»¶ã€‚"

result = agent.run(question)

# æŸ¥çœ‹æ‰§è¡Œæ­¥éª¤
for step in result["steps"]:
    print(f"æ­¥éª¤{step['step_id']}: {step['tool_name']} - {'æˆåŠŸ' if step['success'] else 'å¤±è´¥'}")
```

## ğŸ“Š è¿”å›ç»“æœç»“æ„

```python
{
    "answer": "æœ€ç»ˆå›ç­”æ–‡æœ¬",
    "steps": [
        {
            "step_id": 1,
            "tool_name": "rag_search",
            "arguments": {"query": "..."},
            "success": True,
            "result": "å·¥å…·è¿”å›ç»“æœ",
            "error": None,
            "suggestion": None
        },
        ...
    ],
    "sources": [
        {
            "type": "policy",
            "content": "åˆ¶åº¦å†…å®¹..."
        }
    ],
    "intent": {
        "intent_type": "complex_task",
        "requires_policy": True,
        "requires_data": True,
        "requires_generation": True,
        "entities": {...},
        "estimated_steps": 4
    }
}
```

## ğŸ”§ é…ç½®é€‰é¡¹

```python
agent = UnifiedFinancialAgent(
    config_path="config.yaml",      # é…ç½®æ–‡ä»¶è·¯å¾„
    retriever=None,                  # RAG æ£€ç´¢å™¨ï¼ˆå¯é€‰ï¼‰
    verbose=True,                    # æ˜¯å¦æ‰“å°è¯¦ç»†æ—¥å¿—
    max_steps=8                      # æœ€å¤§å·¥å…·è°ƒç”¨æ­¥æ•°
)
```

## ğŸ’¡ å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ç®€å•æŸ¥è¯¢ï¼ˆåªæŸ¥åˆ¶åº¦ï¼‰

```python
result = agent.run("å·®æ—…è´¹æŠ¥é”€çš„æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ")
# Agent ä¼šè‡ªåŠ¨è°ƒç”¨ rag_search å·¥å…·
```

### åœºæ™¯ 2: æ•°æ®æŸ¥è¯¢

```python
result = agent.run("å¸®æˆ‘æŸ¥ä¸€ä¸‹å¼ ä¸‰ 3 æœˆä»½çš„æŠ¥é”€æ€»é‡‘é¢")
# Agent ä¼šï¼š
# 1. è°ƒç”¨ query_employee_info è·å–å¼ ä¸‰çš„å·¥å·
# 2. è°ƒç”¨ query_reimbursement_summary æŸ¥è¯¢æŠ¥é”€ç»Ÿè®¡
```

### åœºæ™¯ 3: å¤æ‚ä»»åŠ¡ï¼ˆè§„åˆ™+æ•°æ®+ç”Ÿæˆï¼‰

```python
question = """
æˆ‘æƒ³ç”³è¯·å·®æ—…æŠ¥é”€ï¼Œå¸®æˆ‘ç¡®è®¤ä¸‹æˆ‘æ˜¯å¦ç¬¦åˆæŠ¥é”€æ¡ä»¶ï¼Œ
å¹¶å¸®æˆ‘å†™ä¸€å°å‘ç»™ HR çš„é‚®ä»¶ã€‚
"""

result = agent.run(question)
# Agent ä¼šï¼š
# 1. è°ƒç”¨ rag_search æŸ¥è¯¢æŠ¥é”€æ¡ä»¶
# 2. è°ƒç”¨ query_employee_info è·å–ç”¨æˆ·ä¿¡æ¯
# 3. è°ƒç”¨ query_reimbursement_summary æŸ¥è¯¢å†å²æ•°æ®
# 4. ç”Ÿæˆé‚®ä»¶å†…å®¹
```

### åœºæ™¯ 4: åˆ›å»ºå·¥å•

```python
result = agent.run(
    "å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå·¥å•ï¼Œæ ‡é¢˜æ˜¯'å®¡æ ¸æŠ¥é”€ç”³è¯·'ï¼Œåˆ†é…ç»™è´¢åŠ¡éƒ¨çš„èµµå…­"
)
# Agent ä¼šï¼š
# 1. è°ƒç”¨ query_employee_info æŸ¥æ‰¾èµµå…­çš„å·¥å·
# 2. è°ƒç”¨ create_work_order åˆ›å»ºå·¥å•
```

## ğŸ› ï¸ å·¥å…·åˆ—è¡¨

### RAG å·¥å…·

- **rag_search**: æ£€ç´¢ä¼ä¸šè´¢åŠ¡çŸ¥è¯†åº“ï¼ŒæŸ¥è¯¢åˆ¶åº¦ã€è§„åˆ™ç­‰

### MCP æ•°æ®åº“å·¥å…·

- **query_employee_info**: æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯
- **query_reimbursement_records**: æŸ¥è¯¢æŠ¥é”€è®°å½•

### MCP API å·¥å…·

- **query_reimbursement_status**: æŸ¥è¯¢æŠ¥é”€çŠ¶æ€
- **query_reimbursement_summary**: æŸ¥è¯¢æŠ¥é”€ç»Ÿè®¡

### MCP æ“ä½œå·¥å…·

- **create_work_order**: åˆ›å»ºå·¥å•

## ğŸ”„ å·¥å…·ä¾èµ–å…³ç³»

Agent ä¼šè‡ªåŠ¨å¤„ç†å·¥å…·ä¾èµ–ï¼š

```
query_reimbursement_summary â†’ query_employee_info
query_reimbursement_status â†’ query_employee_info
create_work_order â†’ query_employee_info
generate_email â†’ rag_search
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **RAG ç´¢å¼•**ï¼šä½¿ç”¨å‰éœ€è¦å…ˆæ„å»ºç´¢å¼•
   ```bash
   python -m rag_system.main index
   ```

2. **MCP æ•°æ®åº“**ï¼šéœ€è¦åˆå§‹åŒ–æ•°æ®åº“
   ```bash
   python mcp/init_database.py
   ```

3. **API æœåŠ¡å™¨**ï¼šéƒ¨åˆ†å·¥å…·éœ€è¦å¯åŠ¨æ¨¡æ‹Ÿ API æœåŠ¡å™¨
   ```bash
   python mcp/mock_api_server.py
   ```

4. **LLM é…ç½®**ï¼šç¡®ä¿ `config.yaml` ä¸­é…ç½®äº†æ­£ç¡®çš„ LLM API Key

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼š

```bash
# è¿è¡Œç¤ºä¾‹
python rag_system/agent/unified_agent_example.py

# è¿è¡Œæµ‹è¯•
python rag_system/agent/unified_agent_test.py
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‡å°‘æ­¥éª¤æ•°**ï¼šå¯¹äºç®€å•æŸ¥è¯¢ï¼ŒAgent ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶å‡å°‘æ­¥éª¤
2. **å¹¶è¡Œæ‰§è¡Œ**ï¼šç‹¬ç«‹å·¥å…·å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼ˆæœªæ¥ç‰ˆæœ¬æ”¯æŒï¼‰
3. **ç¼“å­˜ç»“æœ**ï¼šå¸¸è§æŸ¥è¯¢ç»“æœå¯ä»¥ç¼“å­˜ï¼ˆæœªæ¥ç‰ˆæœ¬æ”¯æŒï¼‰

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: RAG ç´¢å¼•æœªåˆå§‹åŒ–

**é”™è¯¯**: `ç´¢å¼•æœªåˆå§‹åŒ–`

**è§£å†³**: è¿è¡Œ `python -m rag_system.main index`

### é—®é¢˜ 2: å·¥å…·è°ƒç”¨å¤±è´¥

**é”™è¯¯**: `è°ƒç”¨å·¥å…·å¤±è´¥`

**è§£å†³**: 
- æ£€æŸ¥å·¥å…·å‚æ•°æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ç¡®è®¤æ•°æ®åº“/API æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

### é—®é¢˜ 3: æ„å›¾ç†è§£ä¸å‡†ç¡®

**è§£å†³**: 
- ä½¿ç”¨æ›´æ˜ç¡®çš„é—®é¢˜æè¿°
- æ£€æŸ¥ LLM é…ç½®æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹ verbose æ—¥å¿—äº†è§£æ„å›¾è¯†åˆ«ç»“æœ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [MCP å·¥å…·ä½¿ç”¨è¯´æ˜](../mcp/ä½¿ç”¨è¯´æ˜.md)
- [RAG ç³»ç»Ÿæ–‡æ¡£](../../README_RAG.md)
- [Agent è®¾è®¡æ–‡æ¡£](./unified_agent.py)

